!function(i){function t(t,e){this.element=t,this.$el=i(t),this.settings=i.extend({},s,e),this.$container=i(this.settings.container),this.settings.width=parseInt(this.settings.width),this.settings.height=parseInt(this.settings.height),this.settings.width>=o?this.settings.width=o:this.settings.width<n&&(this.settings.width=n),this.settings.height>=a?this.settings.height=a:this.settings.height<h&&(this.settings.height=h);-1==i.inArray(this.settings.position,["left","right"])&&(this.settings.position=s.position),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.init()}var e="emojiPicker",s={width:"200",height:"350",position:"right",fadeTime:100,iconColor:"black",iconBackgroundColor:"#eee",container:"body",button:!0},n=200,o=600,h=100,a=350;i.extend(t.prototype,{init:function(){this.active=!1,this.addPickerIcon(),this.createPicker(),this.listen()},addPickerIcon:function(){if(this.settings.button){var t=this.$el.outerHeight(),e=t>50?50:t,s=this.$el.width();this.$el.width(s),this.$wrapper=this.$el.wrap("<div class='emojiPickerIconWrap'></div>").parent(),this.$icon=i('<div class="emojiPickerIcon"></div>').height(e).width(e).addClass(this.settings.iconColor).css("backgroundColor",this.settings.iconBackgroundColor),this.$wrapper.append(this.$icon)}},createPicker:function(){var t=i(function(){var t=[],e=[{name:"emotion",symbol:"grinning"},{name:"animal",symbol:"whale"},{name:"food",symbol:"hamburger"},{name:"folderol",symbol:"abc"},{name:"thing",symbol:"gift"},{name:"travel",symbol:"blue_car"}],s={people:"emotion",nature:"animal",activity:"travel",symbol:"folderol",flag:"folderol",object:"thing",undefined:"thing"},n={},o=function(i){var t="&#x",e=i.unicode.apple;if(e.indexOf("-")>=0){var s=e.split("-");return t+s[0]+t+s[1]}return t+e},h=function(i){return":"+i.shortcode+":"};for(var a in i.each(i.fn.emojiPicker.emojis,function(i,t){var e=s[t.category]||t.category;n[e]=n[e]||[],n[e].push(t)}),t.push('<div class="emojiPicker">'),t.push("<nav>"),e)t.push('<div class="tab'+(0==a?" active":"")+'" data-tab="'+e[a].name+'"><div class="emoji emoji-'+e[a].symbol+'">:'+e[a].symbol+":</div></div>");for(var a in t.push("</nav>"),e){for(var c in t.push('<section class="'+e[a].name+(0==a?"":" hidden")+'">'),n[e[a].name]){var r=n[e[a].name][c];t.push('<div class="emoji emoji-'+r.shortcode+'" title="'+o(r)+'">'+h(r)+"</div>")}t.push("</section>")}return t.push("</div>"),t.join("\n")}());this.$picker=t.appendTo(this.$container).width(this.settings.width).height(this.settings.height).css("z-index",1e4),this.$picker.find("section").height(parseInt(this.settings.height)-40),this.settings.width<240&&this.$picker.find(".emoji").css({width:"1em",height:"1em"})},listen:function(){this.settings.button&&this.$wrapper.find(".emojiPickerIcon").click(i.proxy(this.iconClicked,this)),this.$picker.find("section div").mousedown(i.proxy(this.emojiClicked,this)),this.$picker.find("nav .tab").click(i.proxy(this.emojiCategoryClicked,this)),this.$picker.click(i.proxy(this.pickerClicked,this)),i(document.body).click(i.proxy(this.clickOutside,this)),i(window).resize(i.proxy(this.updatePosition,this))},updatePosition:function(){var i=this.$picker.offsetParent().offset(),t=this.$el.offset();"right"==this.settings.position&&(t.left+=this.$el.outerWidth()-this.settings.width),t.top+=this.$el.outerHeight();var e={top:t.top-i.top-199,left:t.left-i.top+130};return this.$picker.css({top:e.top,left:e.left}),this},hide:function(){this.$picker.fadeOut(this.settings.fadeTime,function(){this.active=!1}.bind(this))},show:function(){this.showImages(),this.$el.focus(),this.updatePosition(),this.$picker.fadeIn(this.settings.fadeTime,function(){this.active=!0}.bind(this))},showImages:function(){this.showSectionImages(this.$picker.find(".tab:not(.emojified), section:not(.hidden):not(.emojified)"))},showSectionImages:function(i){this.showEmojiImages(i.find(".emoji")),i.addClass("emojified")},showEmojiImages:function(t){t.each(function(){var t=i(this),e=emoji.replace_with_unicode(t.html());0==e.indexOf(":")?t.html(t.attr("title")):t.html(e),t.removeAttr("title")}),emojify(t)},iconClicked:function(i){this.$picker.is(":hidden")?this.show():this.hide()},emojiClicked:function(t){var e=i(t.target);e.hasClass("emoji")||(e=e.closest(".emoji"));var s=e.attr("class").split("emoji-")[1],n=i.fn.emojiPicker.emojis.filter(function(i){return i.shortcode===s})[0],o=(n.unicode.apple.indexOf('-') > -1 ? String.fromCodePoint(parseInt(n.unicode.apple.substring(0, n.unicode.apple.indexOf('-')),16), parseInt(n.unicode.apple.substr(n.unicode.apple.indexOf('-') + 1),16)) : String.fromCodePoint(parseInt(n.unicode.apple,16)));(function(i,t){if(document.selection)i.focus(),document.selection.createRange().text=t,i.focus();else if(i.selectionStart||"0"==i.selectionStart){var e=i.selectionStart,s=i.selectionEnd,n=i.scrollTop;i.value=i.value.substring(0,e)+t+i.value.substring(s,i.value.length),i.focus(),i.selectionStart=e+t.length,i.selectionEnd=e+t.length,i.scrollTop=n}else{if ($(i).is('div') && typeof window.rangy!=='undefined'){var sel = rangy.getSelection();if (sel.rangeCount) {var range = sel.getRangeAt(0);var textNode = document.createTextNode(t);range.insertNode(textNode);sel.collapse(textNode,t.length);}}else{i.focus();i.value+=t}}})(this.element,o+" "),i(this.element).trigger("keyup"),this.hide()},emojiCategoryClicked:function(t){var e="";this.$picker.find("nav .tab").removeClass("active");var s=i(t.target).closest(".tab");s.length>0?(e=s.attr("data-tab"),s.addClass("active")):(e=i(t.target).attr("data-tab"),i(t.target).addClass("active")),this.$picker.find("section").addClass("hidden");var n=this.$picker.find("section."+e);this.showSectionImages(n),n.removeClass("hidden")},pickerClicked:function(i){i.stopPropagation()},clickOutside:function(i){this.active&&this.hide()}}),i.fn[e]=function(s){return"string"==typeof s?(this.each(function(){var t=i.data(this,e);switch(s){case"toggle":t.iconClicked()}}),this):(this.each(function(){i.data(this,e)||i.data(this,e,new t(this,s))}),this)},String.fromCodePoint||(String.fromCodePoint=function(){var i,t,e,s,n=[];for(s=0;s<arguments.length;++s)t=(i=arguments[s])-65536,e=i>65535?[55296+(t>>10),56320+(1023&t)]:[i],n.push(String.fromCharCode.apply(null,e));return n.join("")})}(jQuery);