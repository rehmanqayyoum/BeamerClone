function InputTemplatesToolbar(a,b){function f(){showTemplatesToolbar(p());w(p());setTimeout(function(){p().find("input.search").focus();$(document).on("click.hideTemplatesToolbar",function(c){c=$(c.target);c.is(".medium-editor-templates-toolbar")||0!==c.closest(".medium-editor-templates-toolbar").length||g()})},300)}function g(){$(document).unbind("click.hideTemplatesToolbar");hideTemplatesToolbar(p())}function h(){q||l();return q}function l(){q=$(m.renderTemplatesButton(x));y(q);q.mousedown(f);return q}function p(){r||(r=$(renderTemplatesToolbar(x,A)),t=r.find(".medium-editor-templates-toolbar-input input"),y(r));return r}function y(c){a.parent().append(c);a.parent().css("position","relative")}function w(c){var d=c.css;if("undefined"!==typeof m.position&&"undefined"!==typeof m.position.right)var k=m.position.right;else{k=c.parent().outerWidth();var e=c.closest(".feature").outerWidth(),u=c.outerWidth();k=-(e-k+u)/2}"undefined"!==typeof m.position&&"undefined"!==typeof m.position.top?e=m.position.top:(e=c.parent().outerHeight(),u=c.outerHeight(),e=(e-u)/2);d.call(c,{right:k,top:e})}function A(c){if("undefined"!==typeof _canUseTemplates&&_canUseTemplates){var d=c.attr("data-field");c=c.attr("data-name");d="${"+d+"}";var k=a.val();k=k.substring(0,n)+d+k.substring(n,k.length);a.val(k);z(n+d.length-1);B(c)}else g(),displayProPlanBlock("dynamic content")}function B(c){showTemplatesToolbarInput(r);w(p());var d=a.val(),k=n;t.attr("placeholder",c).focus().unbind("keydown").keydown(function(e){if(13===("which"in e?e.which:e.keyCode))return e.preventDefault(),g(),z(k+1),!1}).unbind("keyup").keyup(function(e){13!==("which"in e?e.which:e.keyCode)&&(e=t.val(),""!=e?(e=d.substring(0,n)+";"+e+d.substring(n,d.length),a.val(e)):a.val(d),k=n+(a.val().length-d.length))})}function v(){n=C()}function C(){var c=a[0];if(c.selectionStart||0==c.selectionStart)return c.selectionStart;if(document.selection){c.focus();var d=document.selection.createRange();d.moveStart("character",-c.value.length);return d.text.length}return 0}
function z(c){var d=a[0];d.setSelectionRange?(d.focus(),d.setSelectionRange(c,c)):d.createTextRange&&(d=d.createTextRange(),d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",c),d.select());n=c}var x=(new Date).getTime();a=$(a);var m="undefined"!==typeof b?b:{renderTemplatesButton:renderTemplatesButton,showTemplatesButton:showTemplatesButton,hideTemplatesButton:hideTemplatesButton},n=0,q,r,t;l();a.addClass("extendedInput").focus(function(){m.showTemplatesButton(h(),!0)}).blur(function(){m.hideTemplatesButton(h())}).keyup(v).click(v).change(v)}
var renderTemplatesButton=function(a){return $("<div>").addClass("medium-editor-templates-button tooltippable").attr("id","medium-editor-templates-button-"+a).attr("data-tooltip-title","Insert user data").append($("<span>").text("{···}"))},showTemplatesButton=function(a,b){$(a).addClass("medium-editor-button-active");"undefined"!==typeof b&&b&&$(a).addClass("medium-editor-button-visible");initTooltippables()},hideTemplatesButton=function(a){$(a).removeClass("medium-editor-button-active").removeClass("medium-editor-button-visible")},isButtonVisible=function(a){return $(a).hasClass("medium-editor-button-active")},renderTemplatesToolbar=function(a,b){return $("<div>").attr("id","medium-editor-templates-toolbar-"+a).addClass("medium-editor-templates-toolbar medium-editor-stalker-toolbar").append(renderTemplatesToolbarList(a,b)).append(renderTemplatesToolbarInput())},showTemplatesToolbar=function(a){$(a).addClass("medium-editor-toolbar-active")},showTemplatesToolbarInput=function(a){$(a).addClass("default")},hideTemplatesToolbar=function(a){$(a).removeClass("medium-editor-toolbar-active").removeClass("default");$(a).find("input").val("");$(a).find("ul.fields li").removeClass("hidden")},isToolbarVisible=function(a){return $(a).hasClass("medium-editor-toolbar-active")},renderTemplatesToolbarList=function(a,b){var f=$("<div>").addClass("fieldsContainer"),g=$("<input>").addClass("search").attr("type","text").attr("placeholder","Search attributes").keydown(function(l){var p=$(l.target).parent().find("ul");if(13===("which"in l?l.which:l.keyCode))return event.preventDefault(),b(p.find("li.focused")),!1}).keyup(handleTemplatesToolbarListSearch.bind(null,b));f.append(g);a=$("<ul>").addClass("fields").attr("id","medium-editor-templates-toolbar-actions"+a).addClass("medium-editor-templates-toolbar-actions").show();for(g=0;g<_segmentFields.length;g++){var h=_segmentFields[g];shouldSkipField(h)||(h=$("<li>").addClass("field").attr("data-field",h.code).attr("data-type",h.type).attr("data-name",h.name).append(renderFieldIcon(h.type,h.code)).append($("<div>").addClass("name").text(h.name)).click(function(){b($(this))}),0===g&&h.addClass("focused"),a.append(h))}f.append(a);return f},renderTemplatesToolbarInput=function(){return $("<div>").addClass("medium-editor-templates-toolbar-input").append($("<label>").attr("for","medium-editor-templates-toolbar-input-field").text("Default:")).append($("<input>").attr("id","medium-editor-templates-toolbar-input-field"))},renderFieldIcon=function(a,b){return $("<i>").addClass("material-icons").text(selectFieldIcon(a,b))},selectFieldIcon=function(a,b){if("name"===b||"first_name"===b||"last_name"===b)return"person";if("browser"===b)return"tab";if("os"===b)return"computer";if("city"===b)return"location_city";if("countryCode"===b||"country"===b)return"public";if("segment_filters"===b)return"filter_list";if("last_nps_score"===b)return"bubble_chart";switch(a){case 1:return"compare_arrows";case 2:return"bar_chart";case 3:return"view_week";case 4:return"today";default:return"text_fields"}},handleTemplatesToolbarListSearch=function(a,b){var f=$(b.target),g=f.parent().find("ul");b="which"in b?b.which:b.keyCode;if(13===b)return event.preventDefault(),a(g.find("li.focused")),!1;if(38===b)return event.preventDefault(),focusPrevField(g),!1;if(40===b)return event.preventDefault(),focusNextField(g),!1;a=f.val().toLowerCase().trim();searchFields(a,g)},focusNextField=function(a){var b=a.find("li.focused");if(0<b.length){var f=b.nextAll("li:not(.hidden)").first();0<f.length&&(b.removeClass("focused"),f.addClass("focused"))}else a.find("li:not(.hidden)").first().addClass("focused");scrollToFocusedField(a)},focusPrevField=function(a){var b=a.find("li.focused");if(0<b.length){var f=b.prevAll("li:not(.hidden)").first();0<f.length&&(b.removeClass("focused"),f.addClass("focused"))}else a.find("li:not(.hidden)").first().addClass("focused");scrollToFocusedField(a)},scrollToFocusedField=function(a){var b=a.find("li.focused"),f=b[0].offsetTop,g=f-b.outerHeight(),h=a.scrollTop(),l=h+a.outerHeight();g<h?a.scrollTop(a.scrollTop()-b.outerHeight()):f>l&&a.scrollTop(a.scrollTop()+b.outerHeight())},searchFields=function(a,b){""!==a?b.find("li").each(function(){0>$(this).attr("data-field").toLowerCase().indexOf(a)&&0>$(this).attr("data-name").toLowerCase().indexOf(a)?$(this).addClass("hidden"):$(this).removeClass("hidden")}):b.find("li").removeClass("hidden");b.find("li").removeClass("focused");b.find("li:not(.hidden)").first().addClass("focused")},shouldSkipField=function(a){return $("#npsForm").is(":visible")||$("#editLanguagesForm").is(":visible")?"score"===a.code||"feedback"===a.code||"date_at"===a.code||"ref_url"===a.code||"origin"===a.code:!1};