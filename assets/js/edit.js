var editor,numberOfLanguages,allLanguages,pictureIds={},pendingUploads=0,pendingDownloads=0,saving=!1,_saveRequest,_dateFormat="MM/DD/YYYY hh:mmA",Creator={init:function(){$(window).on("beforeunload",function(){if(!saving&&contentModified)return!0}).on("unload",function(){var a=$('input[name="id"]').val();"undefined"!==typeof a&&""!==a&&(navigator.sendBeacon?(a=new URLSearchParams({id:a,_csrfToken:_csrfToken}),navigator.sendBeacon("lockFeature",a)):$.ajax({type:"POST",url:"lockFeature",data:{id:a,_csrfToken:_csrfToken}}))});$(document).ready(function(){initEditor({templatesToolbar:!0,codeButton:"undefined"!==typeof _canUseCode&&_canUseCode,contributorButton:"undefined"!==typeof _canUseContributor&&_canUseContributor,emojiButton:!0,insert:{images:{url:"uploadPicture"}}});$(".actionURL").bind("input",function(){$(this).css("border","none");$(this).css("border-bottom","1px solid #e8e8e8");$(".LinkErrorMessage").css("display","none");$(".URLErrorMessage").css("display","none")});var a=$('.featureAction input[type="text"], .featureAction input[type="url"]');a.each(function(){var b=$(this);""!==b.val().trim()&&b.addClass("notEmpty")});a.on("keyup",function(){var b=$(this);""===b.val().trim()?b.removeClass("notEmpty"):b.hasClass("notEmpty")||b.addClass("notEmpty")});initSwitches();initEditorFiltersAutocomplete();initBoostedAnnouncementsSelector();initFromDatepicker();initPermalinkEditor();$("#datepicker, #datepickerDue").focus(function(b){$(".featureDate label").toggle()}).blur(function(b){$(".featureDate label").toggle()})})}},initFromDatepicker=function(){var a=$("#datepicker"),b=$("#datepickerDue");initDatepicker(a);initDatepicker(b,!0);a.change(function(){a.siblings('input[name="dateEdited"]').val(""!==a.val().trim())});b.focus(function(){setTimeout(function(){$("#ui-datepicker-div .ui-datepicker-current").on("mousedown.clearDatepicker",function(c){c.stopPropagation();c.preventDefault();b.datepicker("hide");b.datepicker("setDate",null);return!1})},100)})},initDatepicker=function(a,b){var c={controlType:"select",oneLine:!0,timeFormat:"hh:mmTT",onSelect:function(d){var k=a.attr("data-enable-scheduling"),g=moment(),h=$(".featureButtons .button");if("undefined"!==typeof b&&b||moment(d,_dateFormat).isAfter(g))if("true"!==k&&!0!==k){displayStartupBlock("post scheduling");if("undefined"!==typeof b&&b){a.val("").attr("value","");return}d=g.format(_dateFormat);a.datetimepicker("hide")}else h.find(".unscheduled").hide(),h.find(".scheduled").show();else h.find(".scheduled").hide(),h.find(".unscheduled").show();"undefined"!==typeof b&&b||!moment(d,_dateFormat).isSame(g,"minute")?a.val(d).attr("value",d):a.val("").attr("value","").change();"undefined"!==typeof b&&b?(k=$("#datepicker"),""!==d?(d=d.split(" "),k.datetimepicker("option",{maxDate:d[0],maxTime:d[1]})):k.datetimepicker("option",{maxDate:!1,maxTime:!1})):(k=$("#datepickerDue"),""!==d?(d=d.split(" "),k.datetimepicker("option",{minDate:d[0],minTime:d[1]})):k.datetimepicker("option",{minDate:!1,minTime:!1}))}};if("undefined"!==typeof b&&b){var e=$("#datepicker"),f=e.val();""!==e?(e=f.split(" "),c.minDate=e[0],c.minTime=e[1]):(c.minDate=!1,c.minTime=!1);c.currentText="Clear";c.onClose=function(){$("#ui-datepicker-div .ui-datepicker-current").unbind("mousedown.clearDatepicker")}}""===a.val().trim()&&(e=moment(),c.hour=e.hour(),c.minute=e.minute());a.datetimepicker(c)},initPermalinkEditor=function(){var a=function(b){var c=b.find("input");b.removeClass("editing");var e=c.val().trim(),f=c.attr("data-previous-value");""===e?c.val(f):e!==f&&b.find(".permalink .permalinkPath").text(encodeURIComponent(e))};$(".featurePermalink .permalinkEditButton").click(function(){var b=$(this).closest(".featurePermalink");if(b.hasClass("editing"))a(b);else{var c=b.find("input"),e=c.val();b.addClass("editing");c.focus().val("").val(e)}});$(".featurePermalink input").keydown(function(b){if(13===("which"in b?b.which:b.keyCode))return b.preventDefault(),b.stopPropagation(),a($(this).closest(".featurePermalink")),!1})},deleteTranslation=function(a){if(a=getCurrentLanguage()){try{var b=$("#"+a)}catch(k){b=$(document.getElementById(a))}for(var c=!0,e=0;e<allLanguages.length;e++){var f=allLanguages[e];try{var d=$("#"+f)}catch(k){d=$(document.getElementById(f))}if(f!==a&&""!==d.find('input[name="title"]').val().trim()){c=!1;break}}b.find("input").not('input[type="hidden"]').val("");b.find("div.editable")[0].innerHTML="";hideTopAlert();c?$("body").prepend("<div class='alert red'><span class='closebtn' onclick='hideTopAlert(this);'><i class='material-icons' title='close'>close</i></span><strong> Form cleared. To delete that post click Save.</strong></div>"):$("body").prepend("<div class='alert green'><span class='closebtn' onclick='hideTopAlert(this);'><i class='material-icons' title='close'>close</i></span><strong> Form cleared. Click Save to make changes permanent and remove translation.</strong></div>");showTopAlert()}},checkAction=function(){for(var a=!0,b=document.getElementsByClassName("actionName"),c=document.getElementsByClassName("actionURL"),e=document.getElementsByClassName("LinkErrorMessage"),f=document.getElementsByClassName("URLErrorMessage"),d=document.getElementsByClassName("CategoryErrorMessage"),k=document.getElementsByClassName("customCategoryErrorMessage"),g=0;g<b.length;g++)""!==b[g].value&&""===c[g].value&&(c[g].style.border="1px solid red",e[g]&&(e[g].style.display="block"),a=!1,displayLanguageEditor(allLanguages[g])),""==c[g].value||isUrl(c[g].value)||(c[g].style.border="1px solid red",f[g]&&(f[g].style.display="block"),a=!1,displayLanguageEditor(allLanguages[g]));b=getSelectedCategories();0===b.length?(d[0].style.display="block",a=!1):1===b.length&&"other"===b[0].toLowerCase()?""===$("input.customCategory").val().trim()?(k[0].style.display="block",a=!1):k[0].style.display="none":d[0].style.display="none";return a},isUrl=function(a){if(/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(a)||/(\/([\w#!:.?+=&%@!\-\/]+))+\/?/.test(a))return!0;if(a.startsWith("mailto:")){var b=a.substr(7);-1<b.indexOf("?")&&(b=b.substring(0,b.indexOf("?")));if(isEmail(b))return!0}return/#[\w#!:.?+=&%@!\-\/]+/.test(a)},isEmail=function(a){return a.toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},save=function(a,b,c,e){if(saving)return!1;contentModified=!1;var f=a?$("#publishButton"):$("#draftButton");if(checkDate()&&checkAction()){var d=function(){if(0<pendingUploads||0<pendingDownloads)f.hasClass("loading")||f.addClass("loading").append($("<div>").addClass("loaderOuter").append(renderLoader())),setTimeout(d,500),Logger.getInstance().logError("Tried to save a post, but there are still "+pendingUploads+" uploads and "+pendingDownloads+" downloads pending");else{var n=$("#featureForm");n.find('input[name="content"], input[name="pictureIds"], input[name="published"], input[name="category"]').remove();for(var q=getEditorContent(),l=0;l<allLanguages.length;l++){var u=pictureIds[allLanguages[l]],v=$("<input>");m=q["contentArea"+allLanguages[l]].value;var r=$("<div>").append(m);r.find("code").each(function(){var t=$(this);t.parent().is("pre")?""===t.text().trim()&&t.parent().remove():t.parent().is("p")&&t.parent().html().trim()===$("<div>").append(t.clone()).html().trim()&&t.parent().html(t.html())});r.find("br").each(function(){0===$(this).closest("code").length&&$(this).remove()});r=r.html();do m=r,r=m.replace(/^(.*)(<p><\/p>|<p style=""><\/p>|<p class=""><\/p>|<p style="" class=""><\/p>|<p class="" style=""><\/p>)$/g,"$1");while(r!==m);r=$("<div>").append(m);r.find(".oembed").remove();m=r.html();v.attr("type","hidden").attr("name","content").val(m);n.append(v);v=$("<input>").attr("type","hidden").attr("name","pictureIds");u&&0<u.length?v.val(u.join()):v.val("");n.append(v)}l=$("<input>").attr("type","hidden").attr("name","published").val(a);n.append(l);l=getSelectedCategories().join(";");l=$("<input>").attr("type","hidden").attr("name","category").val(l);n.append(l);q=!1;u=$('input[name="title"], input[name="content"]');for(l=0;l<u.length;l++)if(""!==$(u[l]).val().trim()){q=!0;break}if(!q)return b&&e&&e(),!1;saving=!0;b?(n=$("#featureForm"),l=n.serializeArray(),l.push({name:"ajax",value:!0}),l.push({name:"_csrfToken",value:_csrfToken}),_saveRequest&&_saveRequest.abort(),_saveRequest=$.ajax({url:n.attr("action"),type:"POST",data:l,success:function(t){c&&c(t)},complete:function(){saving=!1;_saveRequest=null;f.removeClass("loading").find(".loaderOuter").remove()}})):n.submit()}},k=function(){f.hasClass("loading")||f.addClass("loading").append($("<div>").addClass("loaderOuter").append(renderLoader()));validatePermalinks(d,function(n){f.removeClass("loading").find(".loaderContainer").remove();if("undefined"!==typeof n){for(var q="",l=0;l<n.length;l++)q+="<li>/"+n[l]+"</li>";showModalAlert("⚡️ Oops! Looks like some of the <b>permalinks</b> you edited are already in use - please edit them:<br><ul>"+
(q+"</ul>"),"permalinksAlert")}else showModalAlert("⚡️ Oops! Looks like some of the <b>permalinks</b> you edited are invalid - please edit them","permalinksAlert")})};if(!editorHasContent())return showModalAlert("⚡️ Oops! Looks like your post is empty!"),!1;if(a){var g=$(".featureButtons .button .scheduled").is(":visible");if(g){var h=$("#datepicker").val(),p=$("#datepickerDue").val().trim(),w="Schedule post";var m="undefined"!==typeof h&&""!==h.trim()?"Are you sure you want to schedule this post to be published on <strong>"+
h+"</strong>":"Are you sure you want to schedule this post to be published <strong> now </strong>";""!==p&&(m+=" and expired on <strong>"+p+"</strong>");m+="?"}else w="Publish post",m="Are you sure you want to publish this post?";h=$('input[name="sendEmailNotification"]').val();"undefined"!==typeof h&&"true"==h&&(m+="<br>",m=g?m+"When published, it will also send out an email notification":m+"This will also send out an email notification",g=$('input[name="roles"]').val(),h=$('input[name="filterUserId"]').val(),"undefined"!==typeof g&&""!==g.trim()||"undefined"!==typeof h&&""!==h.trim()?m+=" to all subscribed users that match the specified segmentation.":(g=1E5<_emailSubscribedUsers?numberWithCommas(Math.trunc(_emailSubscribedUsers/1E3))+"k":numberWithCommas(_emailSubscribedUsers),m+=" to <strong>"+g+"</strong> users."));showModalConfirm(w,m,k)}else k()}return!1},editorHasContent=function(){for(var a=$('input[name="title"]'),b=0;b<a.length;b++)if(""!==$(a[b]).val().trim())return!0;a=getEditorContent();for(b=0;b<allLanguages.length;b++){var c=a["contentArea"+allLanguages[b]].value;c=$("<div>").append(c);c.find("code").each(function(){var f=$(this);f.parent().is("pre")?""===f.text().trim()&&f.parent().remove():f.parent().html(f.html())});c.find("br").each(function(){0===$(this).closest("code").length&&$(this).remove()});var e=c.html();do c=e,e=c.replace(/^(.*)(<p><\/p>|<p style=""><\/p>|<p class=""><\/p>|<p style="" class=""><\/p>|<p class="" style=""><\/p>)$/g,"$1");while(e!==c);c=$("<div>").append(c);c.find(".oembed").remove();if(""!==c.html().trim())return!0}return!1},preview=function(a,b,c,e){if(saving||0<pendingUploads)return!1;"undefined"!==typeof a&&a&&(a=$(a));"undefined"!==typeof e&&e||(e="Do you want to save as draft and preview this post?");showModalConfirm(e,function(){a&&(a.hasClass("button")?a.text("Generating preview...").attr("disabled","disabled"):a.append(renderLoader()));save(!1,!0,function(f){$('#featureForm input[name="id"]').val(f);a&&(a.hasClass("button")?a.removeAttr("disabled").empty().html('<i class="material-icons">visibility</i>Preview'):a.find(".loaderContainer").remove());"undefined"!==typeof c&&c?c(f):BeamerPreview.show(b)},function(){a&&(a.hasClass("button")?a.removeAttr("disabled").empty().html('<i class="material-icons">visibility</i>Preview'):a.find(".loaderContainer").remove())})})},renderSmallLoader=function(){div.loaderElement>div.loaderSubelement},getUrlParameter=function(a){var b=decodeURIComponent(window.location.search.substring(1)).split("&"),c;for(c=0;c<b.length;c++){var e=b[c].split("=");if(e[0]===a)return void 0===e[1]?!0:e[1]}},lastActive=$.now(),active=!0,maxTime=$.now()+6E4;$(document).ready(function(){0==$("#blurry").length&&null!=getUrlParameter("id")&&(updateEditTime(),timer=setInterval(updateEditTime,6E4),userAction())});var updateEditTime=function(){currTime=$.now();maxTime=lastActive+6E5;id=getUrlParameter("id");active&&($.ajax({type:"POST",url:"lockFeature",data:{id:id,activeUser:!0,_csrfToken:_csrfToken},dataType:"json",success:function(a){a?(lastActive=currTime,userAction()):(clearInterval(timer),$(document).off("mousemove"),$(document).off("mousedown"),$(document).off("keypress"),$("body").prepend("<div class='alert red'><span class='closebtn' onclick='hideTopAlert(this);'><i class='material-icons' title='close'>close</i></span><strong> This post was edited by another user. Please copy your changes and reload this page.</strong></div>"),showTopAlert(),$(".featureButtons").remove())}}),active=!1)},userAction=function(){$(document).one("mousemove",function(a){active=!0;$.now()>maxTime&&updateEditTime()});$(document).one("mousedown",function(a){active=!0;$.now()>maxTime&&updateEditTime()});$(document).one("keypress",function(a){active=!0;$.now()>maxTime&&updateEditTime()})},displayPlanBlock=function(a,b){var c=$("#filtersBlock");if(a&&""!==a.trim()){c.find(".modalTitle.default").hide();c.find(".modalTitle.custom").show().find(".customFeature").text(a);try{var e=window.location.pathname.replace("/","")+"_"+a.toLowerCase().replace(/\s+/g,"-"),f=c.find("a.action.primary"),d=f.attr("href");0<=d.indexOf("refUpgrade=")&&(d=d.replace(/[?&]refUpgrade=[^&]+/,""));d=0<=d.indexOf("?")?d+"&":d+"?";d+="refUpgrade="+encodeURIComponent(e);f.attr("href",d)}catch(k){}}else c.find(".modalTitle.custom").hide(),c.find(".modalTitle.default").show();b&&""!==b.trim()?c.find(".popUpgrade").attr("data-feature",b):c.find(".popUpgrade").attr("data-feature","");c.fadeIn("fast");0<c.find(".modalClose:visible").length&&setTimeout(function(){$("html").one("click.hidePlanBlock",hidePlanBlock)},100)},displayStartupBlock=function(a,b){var c=$("#startupBlock");if(a&&""!==a.trim()){c.find(".modalTitle.default").hide();c.find(".modalTitle.custom").show().find(".customFeature").text(a);try{var e=window.location.pathname.replace("/","")+"_"+a.toLowerCase().replace(/\s+/g,"-"),f=c.find(".modalActions a"),d=f.attr("href");0<=d.indexOf("refUpgrade=")&&(d=d.replace(/[?&]refUpgrade=[^&]+/,""));d=0<=d.indexOf("?")?d+"&":d+"?";d+="refUpgrade="+encodeURIComponent(e);f.attr("href",d)}catch(k){}}else c.find(".modalTitle.custom").hide(),c.find(".modalTitle.default").show();b&&""!==b.trim()?c.find(".popUpgrade").attr("data-feature",b):c.find(".popUpgrade").attr("data-feature","");c.fadeIn("fast");0<c.find(".modalClose:visible").length&&setTimeout(function(){$("html").one("click.hidePlanBlock",hidePlanBlock)},100)},displayBoostedAnnouncementsBlock=function(a){displayStartupBlock("boosted announcements","notifications")},hidePlanBlock=function(){$("#filtersBlock, #startupBlock, #globalProBlock, #boostedAnnouncementsBlock").hide();$("html").unbind("click.hidePlanBlock");$(".news").removeClass("blocked")},hasHtml=function(a){return 0<$("<div>").append(a).children().length},confirmAutoOpen=function(a,b){b=$(b);if(b.hasClass("off"))return a.preventDefault(),showModalConfirm("Are you sure you want to do this?","This will open the sidebar automatically for <strong>all the users that can see this post</strong>. We recommend using this option only for important posts.",function(){turnOnSwitch(b)}),!1},confirmPin=function(a,b){b=$(b);if(b.hasClass("off"))return a.preventDefault(),a=$("<span>").text("This will pin the post ").append($("<strong>").text("on top of your feed")).append(". We recommend using this option only for important posts."),"undefined"!==typeof _currentPinnedFeature&&_currentPinnedFeature&&a.append("<br>Doing so will unpin the post ").append($("<strong>").text(_currentPinnedFeature)),showModalConfirm("You are about to pin this post",a.html(),function(){turnOnSwitch(b)}),!1},enablePushNotifications=function(a,b){b=$(b);if((b.is(".chooserOption:not(.selected)")||b.hasClass("off"))&&!b.hasClass("pushEnabled")){var c=$(a.target);if(!c.is(".chooserPreview")&&0===c.closest(".chooserPreview").length)return a.preventDefault(),showModalConfirm("Do you want to enable push notifications?","⚠️ <strong>WARNING</strong>: If you click the Accept button your users will be shown a prompt to allow push notifications, which you can configure later in <strong>Settings</strong>.",function(){$.ajax({url:"enablePush",type:"POST",data:{_csrfToken:_csrfToken},success:function(){b.addClass("pushEnabled");b.hasClass("chooserOption")?selectBoostedAnnouncementsOption(b):turnOnSwitch(b)}});closeModals()}),!1}return!0},enableEmailNotifications=function(a,b){b=$(b);var c=$(a.target);return!b.is(".chooserOption:not(.selected)")&&!b.hasClass("off")||b.hasClass("emailEnabled")||c.is(".chooserPreview")||0!==c.closest(".chooserPreview").length?!0:(a.preventDefault(),showModalConfirm("Do you want to enable email notifications?","Your users will be able to subscribe for email notifications in your feed.<br><br>When first enabling <strong>email notifications</strong>, it may take up to 1 hour to pre-heat your sending address. Expect some delay when sending out your first emails!",function(){$.ajax({url:"enableEmailNotifications",data:{enableEmailNotifications:!0,_csrfToken:_csrfToken},type:"POST",success:function(){b.addClass("emailEnabled");b.hasClass("chooserOption")?selectBoostedAnnouncementsOption(b):turnOnSwitch(b)}});closeModals()}),!1)},initEditorFiltersAutocomplete=function(){var a=$("input#roles"),b=$('input[name="roles"]'),c=a.attr("data-autocomplete");void 0!==c&&"true"==c&&initFiltersAutocomplete(a,b,"#segmentationAction")},initBoostedAnnouncementsSelector=function(){$(".featureAction.boostedAnnouncements").find(".chooser .chooserOption:not(.disabled)").click(function(a){var b=$(this);$(a.target).is(".chooserPreview")?showBoostedAnnouncementsPreview(b):(a=b.attr("data-type"),"sidebar"==a||"standalone"==a||"push"==a||"email"==a||_canUseBoostedAnnouncements?b.hasClass("selected")?deselectBoostedAnnouncementsOption(b):selectBoostedAnnouncementsOption(b):displayBoostedAnnouncementsBlock(b.attr("data-type")))})},selectBoostedAnnouncementsOption=function(a){switch(a.attr("data-type")){case "sidebar":$('input[name="showInWidget"]').val(!0);break;case "standalone":$('input[name="showInPublicPage"]').val(!0);break;case "push":$('input[name="sendPushNotification"]').val(!0);break;case "email":$('input[name="sendEmailNotification"]').val(!0);break;default:$(".featureAction.boostedAnnouncements .chooser .chooserOption.boosted").removeClass("selected"),$('input[name="boostedAnnouncementType"]').val(a.attr("data-value")),"topbar"===a.attr("data-type")?$(".switchbox.fixedBoostedAnnouncement").fadeIn("fast"):$(".switchbox.fixedBoostedAnnouncement").fadeOut("fast")}a.addClass("selected")},deselectBoostedAnnouncementsOption=function(a){switch(a.attr("data-type")){case "sidebar":$('input[name="showInWidget"]').val(!1);break;case "standalone":$('input[name="showInPublicPage"]').val(!1);break;case "push":$('input[name="sendPushNotification"]').val(!1);break;case "email":$('input[name="sendEmailNotification"]').val(!1);break;default:$('input[name="boostedAnnouncementType"]').val(0),$(".switchbox.fixedBoostedAnnouncement").fadeOut("fast")}a.removeClass("selected")},showBoostedAnnouncementsPreview=function(a){hideBoostedAnnouncementsPreview();var b=a.attr("data-type");if("sidebar"!==b&&"standalone"!==b){var c=$(".featureForm:visible"),e=c.find('input[name="title"]').val().trim(),f=c.find('input[name="actionName"]').val().trim(),d=c.find('input[name="action"]').val().trim();if("undefined"===typeof _showBoostedCategory||!0===_showBoostedCategory){var k=$(".selectedCategories .category:first .name").text();var g="red";var h=$(".selectedCategories .category .dot");0<h.length&&(h=h.css("background-color"),"undefined"!==typeof h&&""!==h&&(g=h))}h=getEditorContent();$("<input>");content=h[c.find(".editable").attr("id")].value;content=content.replace(/(<br>)*/g,"");content=content.replace(/(<p><\/p>)*/g,"");var p=$("<div>").append(content);p.find(".oembed").remove();h=p.html();p=p.text();try{p=p.replace(/(?:!\[)([^\[\]]*)(?:\])/g,"").trim()}catch(q){}var w;c=c.find(".medium-insert-images img");0<c.length&&(w=$(c[0]).attr("src"))}var m=$("#featureForm .feature").hasClass("rtl");e="undefined"!==typeof e&&""!==e.trim()?formatPreviewTemplateString(e):void 0;p="undefined"!==typeof p&&""!==p.trim()?formatPreviewTemplateString(p):void 0;f="undefined"!==typeof f&&""!==f.trim()?formatPreviewTemplateString(f):void 0;d="undefined"!==typeof d&&""!==d.trim()&&("push"===b||"undefined"!==typeof _openBoostedLinks&&_openBoostedLinks)?formatPreviewTemplateString(d):void 0;switch(b){case "sidebar":preview(a);break;case "standalone":preview(a,!0);break;case "push":showPushNotificationPreview(e,p,w,d);break;case "email":var n=$(".languageTab.active").attr("data-language");preview(null,!1,function(q){sendEmailPreview(q,n)},"Do you want to save as draft and preview this post?<br>You will receive a preview email at <strong>"+
_currentEmail+"</strong>");break;case "topbar":Beamer.showAnnouncementBar("top",e,null,k,f,d,!0,window._topbarTextColor,window._topbarBackgroundColor,m,null,!1,!1,!0);break;case "popup":preview(null,!1,function(q){Beamer.showAnnouncementPopup(q,null,null,!0)});break;case "snippet":a=formatPreviewTemplateString($("<div>").html(h.replace("</p>","</p>\n").replace("</h2>","</h2>\n").replace("</h3>","</h3>\n")).text());Beamer.showAnnouncementSnippet(e,null,a,f,d,!0,w,null,m,_snippetPosition,null,!1,!0);break;case "tooltip":setTimeout(function(){Beamer.showLastPostTitle(e,0,k,g,m,d,null,null,!0,!0)},500)}},formatPreviewTemplateString=function(a){return a.replaceAll(/\${([^}]+)}/g,function(b,c){return getPreviewTemplateValue(c)})},getPreviewTemplateValue=function(a){a=a.split(";");var b=2==a.length?a[1]:"";switch(a[0]){case "first_name":if(beamer_config_preview.user_firstname)return beamer_config_preview.user_firstname;break;case "last_name":if(beamer_config_preview.user_lastname)return beamer_config_preview.user_lastname;break;case "email":if(beamer_config_preview.user_email)return beamer_config_preview.user_email;break;default:return b}},hideBoostedAnnouncementsPreview=function(){Beamer.closeAnnouncementBar(!0);Beamer.closeAnnouncementPopup();Beamer.closeAnnouncementSnippet(!0);Beamer.closeLastPostTitle()},showPushNotificationPreview=function(a,b,c,e){if(""!==a.trim()){var f=function(){var d={body:b,image:c,icon:window._pushLogoUrl,requireInteraction:!1};!Beamer.isWindows()&&"undefined"!==typeof c&&c&&(d.icon=c,delete d.image);var k=new Notification(a,d);k.onclick=function(){"undefined"!==typeof e?window.open(e,"_blank","noopener,noreferrer"):BeamerPreview.show();k.close()}};try{"Notification"in window&&("granted"===Notification.permission?f():"denied"!==Notification.permission&&Notification.requestPermission().then(function(d){"granted"===d&&f()}))}catch(d){}}},sendEmailPreview=function(a,b){$.ajax({url:"sendEmailPreview",type:"POST",data:{id:a,language:b,_csrfToken:_csrfToken}});hideTopAlert();$("body").prepend("<div class='alert green'><span class='closebtn' onclick='hideTopAlert(this);'><i class='material-icons' title='close'>close</i></span><strong>Check your inbox!</strong> You will receive a preview email in a minute</div>");showTopAlert()},numberWithCommas=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},validatePermalinks=function(a,b){var c=[],e=[];$('#featureForm input[name="permalink"]').each(function(){var d=$(this).val().trim();""!==d&&(c.push(d),d=$(this).closest(".featureForm").find('input[name="language"]').val().trim(),""!==d&&e.push(d))});var f=$('#featureForm input[name="id"]').val();0===c.length||c.length!=e.length?a():$.ajax({url:"validatePermalinks",type:"POST",data:{id:f,permalinks:c.join(";"),languages:e.join(";"),_csrfToken:_csrfToken},success:function(d){d.valid?a():b(d.invalidPermalinks)},error:function(){b()}})};