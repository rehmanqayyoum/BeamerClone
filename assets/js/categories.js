var _defaultCategories=['NEW','IMPROVEMENT','FIX','COMINGSOON','ANNOUNCEMENT'];var _defaultFeatureRequestCategories=['FEATURE_REQUEST','BUG','IMPROVEMENT'];var otherFeatureCat=function(option,isBlocked){option=$(option);var currentCategory=$('.featureCategory.active .categorySelector').attr('data-category');if(typeof currentCategory==='undefined'){if(!option.is('.categoryOther:not(.custom)')){addCategory(isBlocked,false,option);}}else{addCategory(isBlocked,false,option,currentCategory);}
if(option.hasClass('categoryOther')){if(isBlocked){displayStartupBlock('custom categories');}else{if(option.hasClass('custom')){hideCustomCategoryInput();}else{showCustomCategoryInput();}}}else{hideCustomCategoryInput();}
hideCategorySelector();}
var addCategory=function(isBlocked,showBlocked,option,currentCategory){var container=$('.featureCategory.active');var addingCategory=typeof option==='undefined';var addingCustomCategory=false;var selectedCategories=container.find('.selectedCategories');if(addingCategory){hideSelectedCategories();option=container.find('.categorySelector .categorySelectorOption').filter(function(){return $(this).attr('data-disabled')!=='true';}).first();}
var category=option.attr('data-value');if(option.hasClass('categoryOther')){if(typeof isBlocked!=='undefined'&&isBlocked){category='NEW';if(typeof showBlocked!=='undefined'&&showBlocked){displayPlanBlock('multiple categories');}}else{if(option.hasClass('custom')){hideCustomCategoryInput();}else{addingCustomCategory=true;showCustomCategoryInput(category);}}}else{hideCustomCategoryInput();}
addSelectedCategory(category,currentCategory);if(addingCategory&&!addingCustomCategory){showCategorySelector();}else{hideCategorySelector();}}
var addSelectedCategory=function(category,currentCategory){if(category.trim()===''||getSelectedCategories().indexOf(category.toLowerCase())>-1){return;}
var selectedCategories=$('.featureCategory.active .selectedCategories');var categoryElement=$('<div>').attr('data-category',category).addClass('category').addClass(selectCategoryClass(category)).append($('<span>').addClass('name').text(selectCategoryLabel(category))).click(function(event){var target=$(event.target);if(!target.is('.delete')&&target.closest('.delete').length===0){showCategorySelector(this);}});var categoryColor=selectCategoryColor(category);if(selectedCategories.attr('data-multiple-categories')=='true'){if(categoryColor){categoryElement.css('background',categoryColor);}
var deleteElement=$('<div>').addClass('delete');var clearElement=$('<i>').addClass('material-icons iconDelete').html('clear').click(function(){removeCategory(this);});deleteElement.append(clearElement);categoryElement.append(deleteElement);}else{var dotElement=$('<span>').addClass('dot category').addClass(selectCategoryClass(category));if(categoryColor){dotElement.css('background',categoryColor);}
categoryElement.prepend(dotElement);var expandElement=$('<i>').addClass('material-icons iconSelect').html('expand_more');categoryElement.append(expandElement);}
if(selectedCategories.attr('data-multiple-categories')=='true'){selectedCategories.find('.addCategory').before(categoryElement);}else{selectedCategories.find('.category').filter(function(){return compareCategories($(this).attr('data-category'),currentCategory);}).replaceWith(categoryElement);}
if(($('.customCategory').val()!=null)&&($('.customCategory').val()!='')){var newCategory=$('<div>').addClass("categorySelectorOption categoryOther custom").attr("data-value",$('.customCategory').val()).attr("onclick","otherFeatureCat(this, false);");var dotSpan=$('<span>').addClass('dot category').addClass(selectCategoryClass(category));var nameSpan=$('<span>').addClass('name').append($('.customCategory').val());newCategory.append(dotSpan);newCategory.append(nameSpan);$('#addCustomCategory').before(newCategory);}
updateSelectedCategories();$('.customCategoryErrorMessage').hide();}
var removeCategory=function(element){element=$(element);element=element.closest('.category:not(.dot)');var select=element.closest('.featureCategory').find('.categorySelector');select.find('.categorySelectorOption').filter(function(){return compareCategories($(this).attr('data-value'),element.attr('data-category'));});element.remove();updateSelectedCategories();}
var updateCustomCategory=function(event,input){var key='which'in event?event.which:event.keyCode;if(key==13){event.stopPropagation();hideCustomCategoryInput();}else{if($(event.target).val().trim()!==''){$('.customCategoryErrorMessage').hide();}}}
var showCustomCategoryInput=function(customCategory){var container=$('.featureCategory.active');var input=container.find('.customCategory');if(typeof customCategory!=='undefined'){input.attr('data-category',customCategory);}
container.find('.categoryContainer').slideDown('fast',function(){input.focus();$('html').on('click.customCategory',function(event){var target=$(event.target);if(!target.is('.customCategory')&&target.closest('.categoryContainer').length===0&&input.val().trim()!==''){hideCustomCategoryInput();}})});}
var hideCustomCategoryInput=function(){$('html').unbind('click.customCategory');$('.customCategory:visible').each(function(){var input=$(this);var container=input.closest('.featureCategory');var categories=container.find('.selectedCategories .category');var currentCategory=input.attr('data-category');container.addClass('active');if(currentCategory==='undefined'){var categoryElement=categories.last();}else{var categoryElement=categories.filter(function(){return compareCategories($(this).attr('data-category'),currentCategory);});}
input.removeAttr('data-category').blur();var category=input.val().trim().replace(';','');if(category!==''){if(categoryElement.length===0){var currentCat=getSelectedCategories().join(';');addSelectedCategory(category,currentCat);}else{categoryElement.attr('data-category',category).find('.name').text(category);}}
container.find('.categoryContainer').slideUp('fast',function(){input.val('');});container.removeClass('active');});}
var removeLastCategory=function(){$('.featureCategory.active .selectedCategories').each(function(){removeCategory($(this).find('.category:not(.dot)').last());});}
var selectCategoryClass=function(category){if(isDefaultCategory(category)){return category;}else{var clazz='color-';var number=0;if(category.trim()!=''){for(var i=0;i<category.length;i++){var pos=category.charCodeAt(i)-'a'.charCodeAt(0)+1;number+=Math.abs(pos);}
number=number%10;}
return clazz+number;}}
var isDefaultCategory=function(category){if(typeof _featureRequestEditor!=='undefined'&&_featureRequestEditor){for(var i=0;i<_defaultFeatureRequestCategories.length;i++){if(_defaultFeatureRequestCategories[i].toLowerCase()===category.toLowerCase()){return true;}}}else{for(var i=0;i<_defaultCategories.length;i++){if(_defaultCategories[i].toLowerCase()===category.toLowerCase()){return true;}}}
return false;}
var selectCategoryColor=function(category){var option=$('.featureCategory.active .categorySelectorOption:not(.add)').filter(function(){return compareCategories($(this).attr('data-value'),category);});if(option.length===1){var dot=option.find('.dot');if(dot.length===1&&dot.css('background')){return dot.css('background');}}}
var selectCategoryLabel=function(category){if(typeof getCurrentLanguage==='undefined'){var categoryElement=$('.featureCategory.active .categorySelectorOption').filter(function(){var cat=$(this).attr('data-category');if(!cat){cat=$(this).attr('data-value');}
return compareCategories(cat[0],category);});if(categoryElement.length===1){return categoryElement.find('.name').text();}else{return category;}}
var language=getCurrentLanguage();try{var translations=$('#'+language+'categoryTranslations');}catch(e){var translations=$(document.getElementById(language+'categoryTranslations'));}
if(translations.length>0){var translation=translations.find('span').filter(function(){var cat=$(this).attr('data-category');if(!cat){cat=$(this).attr('data-value');}
return compareCategories(cat[0],category);});if(translation.length>0){return translation.text();}}
return category;}
var getSelectedCategories=function(container){if(typeof container!=='undefined'){var categories=container.find('.selectedCategories .category');}else{var categories=$('.selectedCategories .category');}
return categories.map(function(i,categoryElement){var category=$(categoryElement).attr('data-category');if(category){return category.toLowerCase();}}).get();}
var compareCategories=function(catA,catB){if(typeof catA!=='undefined'&&typeof catB!=='undefined'){return catA.trim().toLowerCase()==catB.trim().toLowerCase();}
return false;}
var hideCategorySelector=function(){var container=$('.featureCategory.active');$('html').unbind('click.categorySelector');var element=container.find('.addCategory');container.find('.categorySelector').removeAttr('data-category').slideUp('fast');element.find('.categoryAdder').show();container.find('.selectedCategoryContainer').removeClass('selectorOpen');container.removeClass('active');}
var hideSelectedCategories=function(){var categorySelector=$('.featureCategory.active .categorySelector');var categories=getSelectedCategories();categorySelector.find('.categorySelectorOption').each(function(){var option=$(this);var category=option.attr('data-value');if(category!='OTHER'){if(categories.indexOf(category.toLowerCase())>-1){option.attr('data-disabled','true').hide();}else{option.removeAttr('data-disabled').show();}}});}
var showCategorySelector=function(currentCategory,clickedElement){if(typeof clickedElement!=='undefined'){var container=$(clickedElement).closest('.featureCategory');}else{var container=$('.featureCategory').first();}
container.addClass('active');var element=container.find('.addCategory');var categorySelector=container.find('.categorySelector');var selectedCategoryContainer=container.find('.selectedCategoryContainer');hideSelectedCategories();if(typeof currentCategory!=='undefined'&&currentCategory!==null){categorySelector.attr('data-category',$(currentCategory).attr('data-category'));}
categorySelector.slideDown('fast');element.find('.categoryAdder').hide();selectedCategoryContainer.addClass('selectorOpen');setTimeout(function(){$('html').on('click.categorySelector',function(event){var target=$(event.target);if(!target.is('.categorySelector')&&target.closest('.categorySelector').length===0&&target.closest('.addCategory').length===0&&!target.is('.category')&&target.closest('.category').length===0){hideCategorySelector();}});},100);}
var updateSelectedCategories=function(){$('.featureCategory').each(function(){selectedCategoriesInput=$(this).find('input.selectedCategoriesInput');if(selectedCategoriesInput.length>0){selectedCategoriesInput.val(getSelectedCategories($(this)).join(';'));}});}